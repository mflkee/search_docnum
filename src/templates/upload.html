{% extends "base.html" %}

{% block title %}Загрузка данных · Консоль Аршин{% endblock %}

{% block content %}
<section class="results-wrapper">
    <header class="results-head">
        <div>
            <h2>Загрузка и запуск обработки</h2>
            <p>Подготовьте Excel и выполните загрузку в консоль</p>
        </div>
    </header>

    <form id="uploadForm" class="terminal-form" enctype="multipart/form-data">
        <fieldset class="terminal-fieldset">
            <legend>1. Выбор файла</legend>
            <label for="file" class="terminal-label">Файл Excel (*.xlsx / *.xls)</label>
            <input type="file" class="form-control terminal-input" id="file" name="file" accept=".xlsx,.xls" required>
            <p class="terminal-hint">Максимальный размер: 100 МБ. Формат — выгрузка реестра СИ.</p>
        </fieldset>

        <fieldset class="terminal-fieldset">
            <legend>2. Параметры колонок</legend>
            <div class="terminal-grid">
                <div class="terminal-grid__item">
                    <label class="terminal-label" for="verificationDateColumn">Колонка "Дата поверки"</label>
                    <input type="text" class="form-control terminal-input" id="verificationDateColumn" name="verification_date_column" value="Дата поверки" placeholder="например, AE или «Дата поверки»">
                </div>
                <div class="terminal-grid__item">
                    <label class="terminal-label" for="certificateNumberColumn">Колонка "№ свидетельства"</label>
                    <input type="text" class="form-control terminal-input" id="certificateNumberColumn" name="certificate_number_column" value="Наличие документа с отметкой о поверке (№ св-ва о поверке)" placeholder="например, AI или полное название">
                </div>
                <div class="terminal-grid__item">
                    <label class="terminal-label" for="sheetName">Лист Excel</label>
                    <input type="text" class="form-control terminal-input" id="sheetName" name="sheet_name" value="Перечень" placeholder="Название листа, по умолчанию «Перечень»">
                </div>
            </div>
        </fieldset>

        <div class="terminal-actions">
            <button type="submit" class="btn btn-success" id="uploadBtn">Запустить обработку</button>
            <span class="terminal-tip">После загрузки откроется статус в отдельной консоли.</span>
        </div>

        <div class="terminal-progress" id="uploadProgress" hidden>
            <span class="terminal-progress__label">Загрузка...</span>
            <div class="progress terminal-progress__bar">
                <div class="progress-bar" role="progressbar" style="width: 0%"></div>
            </div>
            <span class="terminal-progress__value" id="progressText">0%</span>
        </div>
    </form>

    <section class="terminal-feedback" id="resultDiv" style="display: none;">
        <h3>✔ Задача принята</h3>
        <p>Файл успешно передан. Обработка начата.</p>
        <p><span class="terminal-label">Идентификатор:</span> <span id="taskId"></span></p>
        <p>Статус живой консоли: <a href="#" id="statusLink">открыть</a></p>
    </section>

    <section class="terminal-feedback terminal-feedback--error" id="errorDiv" style="display: none;">
        <h3>⚠ Ошибка</h3>
        <p id="errorMessage"></p>
    </section>
</section>

<div id="dropZone" class="drop-overlay" style="display: none;">
    <div class="drop-content">
        <h3>Перетащите Excel сюда</h3>
        <p>или щёлкните, чтобы выбрать файл</p>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/upload.js"></script>
{% endblock %}
